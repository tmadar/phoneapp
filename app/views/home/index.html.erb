<div class="navbar navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container">
			<ul class="nav">
				<li class="active">
					<%= link_to "Home", home_path, :method => :get%>
				</li>
				<li>
					<%= link_to "Agent Settings", users_index_path, :method => :get%></a>
				</li>
				<li>
					<%= link_to "Log Out", destroy_user_session_url, :method => :delete %>
				</li>
			</ul>
		</div>
	</div>
</div>

<div class="available_agents">
	
</div>

<div class="content">
	<h1>Levion Automated Telephone System Home Page</h1>
	<table class="table table-striped table-bordered table-condensed call-padded">
		<tr>
			<th style="width: 30%">Time</th>
			<th style="width: 5%">Duration</th>
			<th style="width: 20%">Callback #</th>
			<th style="width: 10%">Call Status</th>
			<th style="width: 7%">Disposition</th>
			<th style="width: 10%">View Call Info</th>			
		</tr>		
	 <% @calls.each do |call| %>
	<% if not call.user %>
			<tr id="call_<%= call.id %>">
				<td><%= call.received_at.localtime.strftime("%d-%b-%Y %I:%M %P") %></td>
				<td><%= call.duration %></td>
				<td><%= call.caller %></td>
				<td><%= call.status %></td>
				<td>					
					<ul class="nav nav-pills">
					  <li class="dropdown" id="#menu_call_<%= call.id %>">
						
					    <a id="call_<%= call.id %>_disposition" class="dropdown-toggle" data-toggle="dropdown" href="#menu_call_<%= call.id %>">
					      <%= call.disposition %>
					      <b class="caret"></b>
					    </a>
					    <ul class="dropdown-menu">
							<% Call::DISPOSITIONS.each do |disposition| %>
					      <li><%= link_to_function "#{disposition}", "updateStateOfCall(#{call.id}, '#{escape_javascript(disposition)}')" %></li>
							<% end %>
					    </ul>
					  </li>
					</ul>	
				</td>
				<td class ="info">
					<%= link_to('View',  call_path(call), :class => "popover-comment btn", :rel => "popover", :title => "Recent Comment", "data-content" => "#{(call.last_comment ? call.last_comment : "There is no comment entered.")}")%>
				</td>
			</tr>
			<% else %>
			<tr id="call_<%= call.id %>">
				<td colspan="8"><%= call.user.email %> is now <%= call.disposition.downcase %>!</td>
			</tr>
			<% end %>
	<% end %>
	</table>
<%= will_paginate(@calls, :renderer => BootstrapPagination::Rails)%>

	<div class="agent_activity">
		<h1>Agent Activity</h1>
		<table class="table table-striped table-bordered table-condensed call-padded">
			<tr>
				<th>Time</th>
				<th>Agent</th>
				<th>From</th>
				<th>Status</th>			
			</tr>		
	 		<% @user_activities.reverse.each do |user_activity| %>
			<tr id="user_activity_<%= user_activity.id %>">
				<td><%= user_activity.received_at.localtime.strftime("%d-%b-%Y %I:%M %P") %></td>
				<td><%= user_activity.user ? user_activity.user.email : "" %></td>
				<td><%= user_activity.caller %></td>
				<td><%= user_activity.disposition %></td>
			</tr>
			<% end %>
		</table>
	</div>
	
</div>
